<!--{includes: true}-->
<div class="ui dropdown selection"
     (click)="this.field.onSelfClick(this.$event)"
     {init}="this.emptyShown = false; this.selectedShown = false;"
     {class.loading}="this.loading"
     {class.disabled}="this.field.$cfg.disabled"
     {class.search}="this.field.$cfg.searchable"
     {class.multiple}="this.field.isMultiSelection()">

    <input type="hidden"
            ##hidden_field
            [name]="this.field.$cfg.hiddenInputName"
            [value]="this.field.$$selection | join:','">

    <i ##icon_down 
       class="dropdown icon"
       (click)="this.field.onDropdownIconClick(this.$event)"></i>

    <a class="ui label transition"
       {each}="item in this.field.getMultiSelection()">
        {{ this.$parent.field.getItemName(this.item) }}
        <i class="delete icon"
           (click)="this.$parent.field.onItemDeleteClick(this.item, this.$event)"></i>
    </a>

    <input type="text"
           ##search
           class="search"
           {readonly}="this.field.$cfg.readonly"
           {disabled}="this.field.$cfg.disabled"
           {show}="this.field.$cfg.searchable"
           {show.$display}="inline-block"
           (focus)="this.field.onSearchFocus(this.$event)"
           (blur)="this.field.onSearchBlur(this.$event)"
           (key.backspace)="this.field.onSearchBackspace(this.$event)"
           {model}="this.searchQuery">

    <span class="sizer"
          ##sizer
          {if}="this.field.isMultiSelection() && this.field.$cfg.searchable"
          {bind}="this.searchQuery"></span>

    <div class="default text"
         ##default_text
         (click)="this.field.onValueTextClick(this.$event)"
         {show}="!this.searchQuery && !this.field.hasSelection() &&
                    !!this.field.$cfg.emptyText"
         {show.$display}="inline-block"
         {show.$save-state}="this.emptyShown"
         {bind}="this.field.$cfg.emptyText"></div>

    <div class="text"
         ##text
         (click)="this.field.onValueTextClick(this.$event)"
         {class.default}="this.focused && this.searchQuery == ''"
         {show}="!this.searchQuery && !this.field.isMultiSelection() && 
                    this.field.hasSelection()"
         {show.$save-state}="this.selectedShown"
         {show.$display}="inline-block"
         {bind}="this.field.getSelectedName()"></div>

    <!-- replaces two previous text blocks with invisible placeholder -->
    <div style="display: none"
         class="default text"
         {show}="!this.emptyShown && !this.selectedShown && !this.field.$cfg.searchable"
         {show.$display}="inline-block">&nbsp;</div>

    <select ##hidden_select
            (click)="this.field.onHiddenSelectClick(this.$event)"
            (change)="this.field.onHiddenSelectChange(this.$event)"
            {show}="this.field.$cfg.useHiddenSelect"
            {show.$display}="block" 
            {options}="this.field._getSelectOptions()"></select>

    
     <div class="menu transition" ##menu_items>
          <div class="disabled item"
               ##menu_disabled
               {if}="this.field.$cfg.showNotFound && this.field.store.isEmpty()"
               (click.$stopPropagation)
               {bind-html}="this.field.$cfg.notFoundText"></div>
          <a   class="empty item"
               href="#"
               ##menu_empty
               {if}="this.field.$cfg.showEmptyItem && !this.field.store.isEmpty()"
               (click)="this.field.onItemClick(null, this.$event)"
               {bind-html}="this.field.$cfg.emptyItemText"></a>
          <a   class="item"
               href="#"
               {each}="item in this.field.store"
               (click)="this.$parent.field.onItemClick(this.item, this.$event)"
               {bind}="this.$parent.field.getItemName(this.item)"></a>
     </div>
        <!--<div class="pagination_container"
             {cmp}="Pagination"
             {cmp.$autoscroll}="false"
             {show}="this.pagination.hasPages()"
             (click.$stopPropagation)>
        </div>-->
    

</div>
